<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Vendor styles -->
        <link rel="stylesheet" href="/static/formwork/vendors/zwicon/zwicon.min.css">
        <link rel="stylesheet" href="/static/formwork/vendors/animate.css/animate.min.css">

        <!-- App styles -->
        <link rel="stylesheet" href="/static/formwork/css/app.min.css">
        <style>
            #eye{
                cursor: pointer;
            }
            #eye:hover{
                background-color: #ffffff1f;
            }
        </style>
    </head>

    <body data-sa-theme="1" style="overflow: hidden">
        <div class="login">

            <!-- Login -->
            <div class="login__block active" id="l-login">
                <div class="login__block__header">
                    <i class="zwicon-user-circle"></i>
                    Hi there! Please Sign in

                    <div class="actions actions--inverse login__block__actions">
                        <div class="dropdown">
                            <i data-toggle="dropdown" class="zwicon-more-h actions__item"></i>

                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-register" href="#">创建账号</a>
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-forget-password" href="#">忘记密码?</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="login__block__body">
                    <form method="post" action="/auth/login" onsubmit="return formCheck();">
                        <div class="form-group">
                            <input type="text" id="username" name="username" class="form-control text-center" placeholder="Email Address">
                        </div>

                        <div class="form-group">
                            <input type="password" id="password" name="password" class="form-control text-center" placeholder="Password">
                        </div>
                        <button id="loginSubmit" class="btn btn-theme btn--icon"><i class="zwicon-checkmark"></i></button>
                    </form>
                </div>
            </div>

            <!-- Register -->
            <div class="login__block" id="l-register">
                <div class="login__block__header">
                    <i class="zwicon-user-circle"></i>
                    创建账号

                    <div class="actions actions--inverse login__block__actions">
                        <div class="dropdown">
                            <i data-toggle="dropdown" class="zwicon-more-h actions__item"></i>

                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-login" href="#">已有账号?</a>
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-forget-password" href="#">忘记密码?</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="login__block__body">
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="zwicon-user"></i></span>
                        </div>
                        <input id="create-username" type="text" class="form-control form-create-user" placeholder="Name" required>
                        <div class="invalid-feedback">请输入用户名!</div>
                    </div>

                    <div class="form-group input-group form-group--centered">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="zwicon-mail"></i></span>
                        </div>
                        <input id="create-email" type="text" class="form-control form-create-user" placeholder="Email Address" required>
                        <div class="invalid-feedback">请输入邮箱!</div>
                    </div>

                    <div class="form-group input-group form-group--centered">
                        <div id="eye" class="input-group-prepend">
                            <span class="input-group-text"><i class="zwicon-eye"></i></span>
                        </div>
                        <input id="create-password" type="password" class="form-control form-create-user" placeholder="Password" required>
                        <div class="invalid-feedback">请输入密码!</div>
                    </div>

                    <!--<div class="form-group">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" name="radioDisabled" id="login-check" class="custom-control-input form-create-agree">
                            <label class="custom-control-label" for="login-check">Accept the license agreement</label>
                        </div>
                    </div>-->

                    <button id="create-user" class="btn btn-theme btn--icon"><i class="zwicon-checkmark"></i></button>
                </div>
            </div>

            <!-- Forgot Password -->
            <div class="login__block" id="l-forget-password">
                <div class="login__block__header">
                    <i class="zwicon-user-circle"></i>
                    忘记密码?

                    <div class="actions actions--inverse login__block__actions">
                        <div class="dropdown">
                            <i data-toggle="dropdown" class="zwicon-more-h actions__item"></i>

                            <div class="dropdown-menu dropdown-menu-right">
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-login" href="#">已有账号?</a>
                                <a class="dropdown-item" data-sa-action="login-switch" data-sa-target="#l-register" href="#">创建账号</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="login__block__body">
                    <!--<p class="mb-5">Lorem ipsum dolor fringilla enim feugiat commodo sed ac lacus.</p>-->

                    <div class="form-group">
                        <input type="text" class="form-control text-center" placeholder="Email Address">
                    </div>

                    <a href="/login" class="btn btn-theme btn--icon"><i class="zwicon-checkmark"></i></a>
                </div>
            </div>
        </div>

        <!-- Older IE warning message -->
        <!--[if IE]>
            <div class="ie-warning">
                <h1>Warning!!</h1>
                <p>You are using an outdated version of Internet Explorer, please upgrade to any of the following web browsers to access this website.</p>

                <div class="ie-warning__downloads">
                    <a href="http://www.google.com/chrome">
                        <img src="/static/formwork/img/browsers/chrome.png" alt="">
                    </a>

                    <a href="https://www.mozilla.org/en-US/firefox/new">
                        <img src="/static/formwork/img/browsers/firefox.png" alt="">
                    </a>

                    <a href="http://www.opera.com">
                        <img src="/static/formwork/img/browsers/opera.png" alt="">
                    </a>

                    <a href="https://support.apple.com/downloads/safari">
                        <img src="/static/formwork/img/browsers/safari.png" alt="">
                    </a>

                    <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">
                        <img src="/static/formwork/img/browsers/edge.png" alt="">
                    </a>

                    <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">
                        <img src="/static/formwork/img/browsers/ie.png" alt="">
                    </a>
                </div>
                <p>Sorry for the inconvenience!</p>
            </div>
        <![endif]-->

        <!-- Javascript -->
        <!-- Vendors -->
        <script src="/static/formwork/vendors/jquery/jquery.min.js"></script>
        <script src="/static/formwork/vendors/popper.js/popper.min.js"></script>
        <script src="/static/formwork/vendors/bootstrap/js/bootstrap.min.js"></script>
        <script src="/static/formwork/vendors/sweetalert2/sweetalert2.all.min.js"></script>
        <!-- App functions and actions -->
        <script src="/static/formwork/js/app.min.js"></script>
        <script src="/static/js/ming.tools.js"></script>
        <script>
            $(function () {

                // 按下鼠标
                $('#eye').mousedown(function(){
                    $('#create-password').attr("type","text");
                });

                // 抬起鼠标
                $('#eye').mouseup(function(){
                    $('#create-password').attr("type","password");
                    //$(this).unbind('mousedown');  // 解除按下事件
                });

                $("#create-username,#create-email,#create-password").focus(function () {
                    $(this).removeClass("is-valid").removeClass("is-invalid");
                });

                $("#create-username").blur(function () {
                    var $this = $(this);
                    var val = $this.val();
                    if(val){
                        $.ajax({
                            url:"/auth/register/checkUsername",
                            type:"post",
                            data:{username:val},
                            dataType:"json",
                            success:function (data) {
                                mingTools.ajaxResult(data,function () {

                                },function () {
                                    $this.addClass("is-invalid");
                                    $this.siblings(".invalid-feedback").html(data.msg).show();
                                })
                            }
                        });
                    }else{
                        $this.addClass("is-invalid");
                    }
                });

                $("#create-email").blur(function () {
                    var v = mingTools.valid.email($(this).val());
                    if(!v){
                        $(this).addClass("is-invalid");
                    }
                });

                $("#create-password").blur(function () {
                    var val = $(this).val();
                    if(!val || val.length === 0){
                        $(this).addClass("is-invalid");
                    }
                });
                
                $("#create-user").click(function () {
                    var username = $("#create-username");
                    var email = $("#create-email");
                    var password = $("#create-password");
                    //var agree = $(".form-create-agree");
                    username.blur();
                    email.blur();
                    password.blur();
                    if(username.hasClass("is-invalid") || email.hasClass("is-invalid") || password.hasClass("is-invalid")){
                        mingTools.swal("提交失败！");
                    }else{
                        $.ajax({
                            url:"/auth/register",
                            type:"post",
                            data:{username:username.val(),email:email.val(),password:password.val()},
                            dataType:"json",
                            success:function (data) {
                                mingTools.ajaxResult(data,function () {
                                    mingTools.swal(data.msg);
                                },function () {
                                    mingTools.swal(data.msg);
                                })
                            }
                        });
                    }


                });

                //var token = $("meta[name='_csrf']").attr("content");
                //var header = $("meta[name='_csrf_header']").attr("content");
                /*$.ajaxSetup({
                    beforeSend: function (xhr) {
                        if(header && token ){
                            xhr.setRequestHeader(header, token);
                        }
                    }}
                );*/

                /*$("#loginSubmit").click(function () {
                    var username = $("#username").val();
                    var password = $("#password").val();
                    $.ajax({
                        url:"/login",
                        type:"post",
                        data:{username:username,password:password},
                        dataType:"json",
                        success:function (data) {
                            var token = data.data;
                            if(data.code == 1){
                                window.location.href = "/index";
                            }
                        }
                    });
                });*/
            })
            function formCheck(){
                var username = $("#username").val();
                var password = $("#password").val();
                if(username && username.length>0 && password && password.length>0){
                    return true;
                }
                mingTools.swal("请输入用户名或密码！");
                return false;
            }
        </script>
    </body>
</html>