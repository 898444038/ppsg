<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Vendor styles -->
    <link rel="stylesheet" href="/static/formwork/vendors/zwicon/zwicon.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/animate.css/animate.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/overlay-scrollbars/OverlayScrollbars.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/select2/css/select2.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/dropzone/dropzone.css">
    <link rel="stylesheet" href="/static/formwork/vendors/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="/static/formwork/vendors/nouislider/nouislider.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/bootstrap-colorpicker/css/bootstrap-colorpicker.css">
    <link rel="stylesheet" href="/static/formwork/vendors/trumbowyg/ui/trumbowyg.min.css">
    <link rel="stylesheet" href="/static/formwork/vendors/rateyo/jquery.rateyo.min.css">

    <!-- App styles -->
    <link rel="stylesheet" href="/static/formwork/css/app.min.css">
    <style>
        .tags button{
            margin: 0 10px 10px 0;
        }
        .trumbowyg-button-pane {
            background-color: rgba(255, 255, 255, 0.45)!important;
        }
    </style>


</head>

<body data-sa-theme="1">
<main class="main">
    <div class="page-loader">
        <div class="page-loader__spinner">
            <svg viewBox="25 25 50 50">
                <circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>
        </div>
    </div>

    <header class="header">
        <div class="navigation-trigger d-xl-none" data-sa-action="aside-open" data-sa-target=".sidebar">
            <i class="zwicon-hamburger-menu"></i>
        </div>

        <div class="logo d-none d-sm-inline-flex">
            <a href="/index">啪啪三国</a>
        </div>

        <form class="search">
            <div class="search__inner">
                <input type="text" class="search__text" placeholder="Search for people, files, documents...">
                <i class="zwicon-search search__helper"></i>
                <i class="zwicon-arrow-left search__reset" data-sa-action="search-close"></i>
            </div>
        </form>

        <ul class="top-nav">
            <li class="d-xl-none"><a href="#" data-sa-action="search-open"><i class="zwicon-search"></i></a></li>

            <li class="dropdown">
                <a href="#" data-toggle="dropdown" class="top-nav__notify"><i class="zwicon-mail"></i></a>
                <div class="dropdown-menu dropdown-menu-right dropdown-menu--block">
                    <div class="dropdown-header">
                        Messages

                        <div class="actions">
                            <a href="/index" class="actions__item zwicon-plus"></a>
                        </div>
                    </div>

                    <div class="listview listview--hover">


                        <a href="#" class="view-more">View all messages</a>
                    </div>
                </div>
            </li>

            <li class="dropdown top-nav__notifications">
                <a href="#" data-toggle="dropdown" class="top-nav__notify">
                    <i class="zwicon-bell"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right dropdown-menu--block">
                    <div class="dropdown-header">
                        Notifications

                        <div class="actions">
                            <a href="#" class="actions__item zwicon-checkmark-square" data-sa-action="notifications-clear"></a>
                        </div>
                    </div>

                    <div class="listview listview--hover">
                        <div class="listview__scroll scrollbar">

                        </div>

                        <div class="p-1"></div>
                    </div>
                </div>
            </li>

            <li class="dropdown d-none d-sm-inline-block">
                <a href="#" data-toggle="dropdown"><i class="zwicon-checkmark-circle"></i></a>

                <div class="dropdown-menu dropdown-menu-right dropdown-menu--block" role="menu">
                    <div class="dropdown-header">Tasks</div>

                    <div class="listview listview--hover">
                        <a href="#" class="listview__item">
                            <div class="listview__content">
                                <div class="listview__heading">HTML5 Validation Report</div>

                                <div class="progress mt-1">
                                    <div class="progress-bar bg-primary" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </a>

                        <a href="#" class="listview__item">
                            <div class="listview__content">
                                <div class="listview__heading">Google Chrome Extension</div>

                                <div class="progress mt-1">
                                    <div class="progress-bar bg-warning" style="width: 43%" aria-valuenow="43" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </a>

                        <a href="#" class="listview__item">
                            <div class="listview__content">
                                <div class="listview__heading">Social Intranet Projects</div>

                                <div class="progress mt-1">
                                    <div class="progress-bar bg-success" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </a>

                        <a href="#" class="listview__item">
                            <div class="listview__content">
                                <div class="listview__heading">Bootstrap Admin Template</div>

                                <div class="progress mt-1">
                                    <div class="progress-bar bg-info" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </a>

                        <a href="#" class="listview__item">
                            <div class="listview__content">
                                <div class="listview__heading">Youtube Client App</div>

                                <div class="progress mt-1">
                                    <div class="progress-bar bg-danger" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </a>

                        <a href="#" class="view-more">View all Tasks</a>
                    </div>
                </div>
            </li>

            <li class="dropdown d-none d-sm-inline-block">
                <a href="#" data-toggle="dropdown"><i class="zwicon-grid"></i></a>

                <div class="dropdown-menu dropdown-menu-right dropdown-menu--block" role="menu">
                    <div class="row app-shortcuts">
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-calendar-never"></i>
                            <small class="">Calendar</small>
                        </a>
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-document"></i>
                            <small class="">Files</small>
                        </a>
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-mail"></i>
                            <small class="">Email</small>
                        </a>
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-line-chart"></i>
                            <small class="">Reports</small>
                        </a>
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-broadcast"></i>
                            <small class="">News</small>
                        </a>
                        <a class="col-4 app-shortcuts__item" href="#">
                            <i class="zwicon-image"></i>
                            <small class="">Gallery</small>
                        </a>
                    </div>
                </div>
            </li>

            <li class="dropdown d-none d-sm-inline-block">
                <a href="#" data-toggle="dropdown"><i class="zwicon-more-h"></i></a>

                <div class="dropdown-menu dropdown-menu-right">
                    <a href="#" class="dropdown-item" data-sa-action="fullscreen">Fullscreen</a>
                    <a href="#" class="dropdown-item">Clear Local Storage</a>
                    <a href="#" class="dropdown-item">Settings</a>
                </div>
            </li>

            <li class="d-none d-sm-inline-block">
                <a href="#" class="top-nav__themes" data-sa-action="aside-open" data-sa-target=".themes"><i class="zwicon-palette"></i></a>
            </li>
        </ul>

        <div class="clock d-none d-md-inline-block">
            <div class="time">
                <span class="time__hours"></span>
                <span class="time__min"></span>
                <span class="time__sec"></span>
            </div>
        </div>
    </header>

    <aside class="sidebar ">
        <div class="scrollbar">
            <div class="user">
                <div class="user__info" data-toggle="dropdown">
                    <img class="user__img" src="/static/formwork/demo/img/profile-pics/9.jpg" alt="">
                    <div>
                        <div class="user__name">super admin</div>
                        <div class="user__email">123456@qq.com</div>
                    </div>
                </div>
                <div class="dropdown-menu dropdown-menu--invert">
                    <a class="dropdown-item" href="#">View Profile</a>
                    <a class="dropdown-item" href="#">Settings</a>
                    <a class="dropdown-item" href="/logout">Logout</a>
                </div>
            </div>

            <ul class="navigation" id="menuList">

            </ul>
        </div>
    </aside>

    <div class="themes">
        <div class="scrollbar">
            <a href="#" class="themes__item active" data-sa-value="1"><img src="/static/formwork/img/bg/1.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="2"><img src="/static/formwork/img/bg/2.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="3"><img src="/static/formwork/img/bg/3.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="4"><img src="/static/formwork/img/bg/4.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="5"><img src="/static/formwork/img/bg/5.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="6"><img src="/static/formwork/img/bg/6.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="7"><img src="/static/formwork/img/bg/7.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="8"><img src="/static/formwork/img/bg/8.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="9"><img src="/static/formwork/img/bg/9.jpg" alt=""></a>
            <a href="#" class="themes__item" data-sa-value="10"><img src="/static/formwork/img/bg/10.jpg" alt=""></a>
        </div>
    </div>

    <section class="content">
        <div class="content__inner">
            <header class="content__title">
                <h1>发起讨论</h1>

                <div class="actions">
                    <a href="#" class="actions__item zwicon-cog"></a>
                    <a href="#" class="actions__item zwicon-refresh-double"></a>

                    <div class="dropdown actions__item">
                        <i data-toggle="dropdown" class="zwicon-more-h"></i>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a href="#" class="dropdown-item">刷新</a>
                            <a href="#" class="dropdown-item">组件</a>
                            <a href="#" class="dropdown-item">设置</a>
                        </div>
                    </div>
                </div>
            </header>
            <div class="row todo">
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-body">
                            <!--<h4 class="card-title">WYSIWYG Editor</h4>
                            <h6 class="card-subtitle"></h6>-->
                            <div class="input-group input-group-lg" style="margin-bottom: 20px;">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">标题</span>
                                </div>
                                <input type="text" id="title" class="form-control">
                            </div>
                            <form class="dropzone dz-clickable" id="dropzone-upload">
                                <div class="dz-default dz-message">
                                    <span>上传图片</span>
                                </div>
                            </form>
                            <div class="discuss-wysiwyg-editor"></div>
                            <button id="submit" type="button" class="btn btn-theme btn-block">发布</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">标签</h4>
                            <h6 class="card-subtitle">label</h6>
                            <div class="tags">
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="input-group">
                                <input type="text" id="tagName" class="form-control" placeholder="标签名">

                                <a id="addTags" class="input-group-append" href="#" data-toggle="tooltip" data-placement="top" data-original-title="新增标签">
                                    <span class="input-group-text"><i class="zwicon-plus"></i></span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Older IE warning message -->
<!--[if IE]>
<div class="ie-warning">
    <h1>Warning!!</h1>
    <p>You are using an outdated version of Internet Explorer, please upgrade to any of the following web browsers to access this website.</p>

    <div class="ie-warning__downloads">
        <a href="http://www.google.com/chrome">
            <img src="img/browsers/chrome.png" alt="">
        </a>

        <a href="https://www.mozilla.org/en-US/firefox/new">
            <img src="img/browsers/firefox.png" alt="">
        </a>

        <a href="http://www.opera.com">
            <img src="img/browsers/opera.png" alt="">
        </a>

        <a href="https://support.apple.com/downloads/safari">
            <img src="img/browsers/safari.png" alt="">
        </a>

        <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">
            <img src="img/browsers/edge.png" alt="">
        </a>

        <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">
            <img src="img/browsers/ie.png" alt="">
        </a>
    </div>
    <p>Sorry for the inconvenience!</p>
</div>
<![endif]-->
<!-- Javascript -->
<!-- Vendors -->
<script src="/static/formwork/vendors/jquery/jquery.min.js"></script>
<script src="/static/formwork/vendors/popper.js/popper.min.js"></script>
<script src="/static/formwork/vendors/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/formwork/vendors/overlay-scrollbars/jquery.overlayScrollbars.min.js"></script>

<script src="/static/formwork/vendors/jquery-mask-plugin/jquery.mask.min.js"></script>
<script src="/static/formwork/vendors/select2/js/select2.full.min.js"></script>
<script src="/static/formwork/vendors/dropzone/dropzone.min.js"></script>
<script src="/static/formwork/vendors/flatpickr/flatpickr.min.js"></script>
<script src="/static/formwork/vendors/nouislider/nouislider.min.js"></script>
<script src="/static/formwork/vendors/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
<script src="/static/formwork/vendors/trumbowyg/trumbowyg.min.js"></script>
<script src="/static/formwork/vendors/rateyo/jquery.rateyo.min.js"></script>
<script src="/static/formwork/vendors/jquery-text-counter/textcounter.min.js"></script>
<script src="/static/formwork/vendors/autosize/autosize.min.js"></script>
<script src="/static/formwork/vendors/sweetalert2/sweetalert2.all.min.js"></script>
<!-- App functions and actions -->
<script src="/static/formwork/js/app.min.js"></script>
<script src="/static/js/ming.tools.js"></script>
<script>
    $(function () {
        query();
        var editor = $(".discuss-wysiwyg-editor").trumbowyg({autogrow: !0});

        Dropzone.autoDiscover = false;
        $("#dropzone-upload")[0] && $("#dropzone-upload").dropzone({
            url: "/upload/image",
            addRemoveLinks: !0,
            init: function () {
                this.on("success", function (file, data) {
                    // 上传成功触发的事件
                    mingTools.ajaxResult(data,function () {
                        $(".dz-preview").find(".dz-image").find("img[alt='"+file.upload.filename+"']").closest(".dz-image").siblings(".dz-details").find(".dz-filename>span").text(data.data);
                        $(".dz-preview").find(".dz-image").find("img[alt='"+file.upload.filename+"']").attr("alt",data.data);
                    },function () {
                        mingTools.swal(data.msg,data.code)
                    })
                });
            }
        });

        $("#addTags").click(function () {
            var tagName = $("#tagName").val();
            if(tagName && tagName.length>0){
                $.ajax({
                    url:"/ppsg/strategy/discuss/post/tags/addTags",
                    type:"post",
                    data:{name:tagName},
                    dataType:"json",
                    success:function (data) {
                        $("#tagName").val("");
                        mingTools.ajaxResult(data,function () {
                            mingTools.swal(data.msg,data.code);
                        },function () {
                            mingTools.swal(data.msg,data.code);
                        });
                        query();
                    }
                });
            }else{
                mingTools.swal("请输入标签名！");
            }
        });

        $(document).on("click",".discuss-tags",function () {
            //$(this).toggleClass("btn-outline-success");
            $(this).toggleClass("btn-success");
        });

        $("#submit").click(function () {
            var title = $("#title").val();
            var content = $(".discuss-wysiwyg-editor").html();
            var imgs = $("#dropzone-upload").find(".dz-success").find(".dz-filename>span");
            var tags = $(".tags").find("button.btn-success");
            if(!title || title.length === 0){
                mingTools.swal("请输入标题！");
                return;
            }
            if(!content){
                mingTools.swal("请输入内容！");
                return;
            }
            if(!tags || tags.length===0){
                mingTools.swal("请选择标签！");
                return;
            }
            var images = [];
            if(imgs){
                for(var j=0;j<imgs.length;j++){
                    images.push($(imgs[j]).text());
                }
            }
            var tagIds = [];
            for(var i=0;i<tags.length;i++){
                tagIds.push($(tags[i]).attr("data-id"));
            }
            $.ajax({
                url:"/ppsg/strategy/discuss/post/addPost",
                type:"post",
                data:{title:title,content:content,images:images.toString(),tagIds:tagIds.toString()},
                dataType:"json",
                success:function (data) {
                    mingTools.ajaxResult(data,function () {
                        mingTools.swal(data.msg,data.code,function () {
                            window.location.href = "/ppsg/strategy/discuss";
                        })
                    },function () {
                        mingTools.swal(data.msg,data.code)
                    })
                }
            });
        });
    });

    function query() {
        var $tags = $(".tags");
        $.ajax({
            url:"/ppsg/strategy/discuss/post/tags/list",
            type:"get",
            dataType:"json",
            success:function (data) {
                mingTools.ajaxResult(data,function () {
                    $tags.html("");
                    var list = data.data;
                    for (var i=0;i<list.length;i++){
                        $tags.append('<button class="btn btn-theme discuss-tags" data-id="'+list[i].id+'">'+list[i].name+'</button>')
                    }
                });
            }
        });
    }
</script>
</body>
</html>